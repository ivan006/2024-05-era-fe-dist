import{_ as k,ak as O,al as M,ai as C,am as h,U as p,W as s,a4 as u,Z as c,Y as o,an as v,a0 as y,a5 as m,a8 as R,X as f,a2 as E,ao as S,ap as b,aq as g,ar as w,as as D,at as I,au as A}from"./index.1fc303dc.js";const V={name:"SuperRecord",components:{RecordOverviewDynamic:O,RecordOverview:M,SuperTable:C},props:{model:{type:[Object,Function],required:!0},id:{type:Number,required:!0},displayMapField:{type:Boolean,default:!1},user:{type:Object,default:()=>({})}},data(){return{activeTab:"tab",loading:!0}},computed:{rowsAndDataIndicators(){let e={dataIndicators:[],rows:[]};this.model.displayMapFull&&this.model.displayMapFull.rows&&(e.rows=this.model.displayMapFull.rows);for(const r in e.rows)for(const a of e.rows[r].cols)if(a.rows)for(const n of a.rows)for(const d of n.cols)d.dataPoint.data&&e.dataIndicators.push(d.dataPoint.data);else a.dataPoint.data&&e.dataIndicators.push(a.dataPoint.data);return e},canEdit(){return!0},childRelations(){const e=h.computedAttrs(this.model,this.excludedCols),r=[];for(let a in e){const n=e[a];n.usageType.startsWith("relChildren")&&r.push({field:n,currentParentRecord:{item:this.item,model:this.model,relationType:n.usageType,foreignKeyToParentRecord:n.meta.field.foreignKey}})}return r},filteredChildRelations(){let e=[];for(const r of this.childRelations)this.rowsAndDataIndicators.dataIndicators.includes(r.field.name)||e.push(r);return e},headers(){return h.SupaerTableHeaders(this.model,[],this.canEdit,this.displayMapField)},item(){return this.model.query().whereId(this.id).withAll().get()[0]},modelFields(){return h.computedAttrs(this.model,this.excludedCols)}},methods:{getMsg(e){return Array.isArray(e)?e.length>1?`To create first set your active ${e[0]} group and active ${e[1]} group`:"":`To create first set your active ${e} group`},filters(e){return{[e]:this.id}},fetchData(){this.loading=!0,this.model.FetchById(this.id,[],{flags:{},moreHeaders:{},rels:[]}).then(()=>{this.loading=!1}).catch(()=>{this.loading=!1})}},mounted(){this.fetchData()},watch:{activeTab(e){this.$nextTick(()=>{this.$refs[e]&&this.$refs[e][0].fetchData()})}}};function B(e,r,a,n,d,t){const T=p("RecordOverviewDynamic"),F=p("RecordOverview"),P=p("SuperTable");return s(),u("div",null,[c(S,{modelValue:d.activeTab,"onUpdate:modelValue":r[0]||(r[0]=l=>d.activeTab=l),align:"left"},{default:o(()=>[c(v,{name:"tab"},{default:o(()=>[y(" Overview ")]),_:1}),(s(!0),u(m,null,R(t.filteredChildRelations,(l,i)=>(s(),f(v,{key:i,name:"tab-"+i},{default:o(()=>[y(E(l.field.label),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"]),c(A,{modelValue:d.activeTab,"onUpdate:modelValue":r[1]||(r[1]=l=>d.activeTab=l)},{default:o(()=>[c(b,{name:"tab"},{default:o(()=>[d.loading?(s(),u(m,{key:1},[y(" Loading... ")],64)):(s(),u(m,{key:0},[a.model.displayMapFull&&a.model.displayMapFull.rows?(s(),f(T,{key:0,item:t.item,childRelations:t.childRelations,filteredChildRelations:t.filteredChildRelations,superOptions:{headers:t.headers,modelFields:t.modelFields,displayMapField:a.displayMapField,model:a.model,canEdit:t.canEdit,currentParentRel:{},user:a.user}},g({_:2},[R(e.$slots,(l,i)=>({name:i,fn:o(_=>[w(e.$slots,i,D(I(_)))])}))]),1032,["item","childRelations","filteredChildRelations","superOptions"])):(s(),f(F,{key:1,item:t.item,superOptions:{headers:t.headers,modelFields:t.modelFields,displayMapField:a.displayMapField,model:a.model,canEdit:t.canEdit,currentParentRel:{},user:a.user}},null,8,["item","superOptions"]))],64))]),_:3}),(s(!0),u(m,null,R(t.filteredChildRelations,(l,i)=>(s(),f(b,{key:i,name:"tab-"+i},{default:o(()=>[c(P,{ref_for:!0,ref:`tab-${i}`,currentParentRel:l,model:l.field.meta.field.related,canEdit:t.canEdit,user:a.user,forcedFilters:t.filters(l.currentParentRecord.foreignKeyToParentRecord)},g({_:2},[e.$slots[l.field.name]?{name:"create",fn:o(()=>[w(e.$slots,l.field.name)]),key:"0"}:void 0]),1032,["currentParentRel","model","canEdit","user","forcedFilters"])]),_:2},1032,["name"]))),128))]),_:3},8,["modelValue"])])}var q=k(V,[["render",B]]);export{q as S};
